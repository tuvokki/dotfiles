#export JAVA_HOME=/usr/local/java
export JAVA_HOME=/usr/local/jdk1.6.0_13
export GRAILS_HOME=/webdir/grails
export MAVEN_HOME=/usr/local/maven

PATH=$JAVA_HOME/bin:$MAVEN_HOME/bin:$GRAILS_HOME/bin:$PATH

alias apache2ctl='sudo /usr/sbin/apache2ctl'
alias updatedb="sudo /usr/bin/updatedb"
alias lighttpd_restart="sudo /etc/init.d/lighttpd restart"
alias last_logs='clear && ls -1t /webdir/logs/|grep acces | head -5'

#make some directories available via 'hash'
hash -d tuvokwd=/webdir/www.tuvok.nl/
hash -d lenya=/webdir/standalone/lenya/
hash -d lenyapubs=~lenya/build/lenya/webapp/lenya/pubs

function dfh {
 df -h | awk '{ printf "%-15s %s \t%s\n", $6, $4, $5 }'  | grep -v "/lib/init/rw" | grep -v "^/dev" | grep -v "^/usr" | grep -v "^/var"
}

function pound_restart() {
  sudo /etc/init.d/pound restart
}

function pound_tail() {
  sudo tail -f /var/log/syslog |grep pound
}

function pound_cfg() {
  suvim /etc/pound/pound.cfg
}

function jetty-restart() {
  cd /webdir/jetty-4.2.22;
  ./jetty.sh stop;
  echo "Jetty stopped";
  sleep 5;
  echo "Starting Jetty";
  ./jetty.sh start etc/admin.xml etc/jetty.xml;
  cd -;
  tail -f /webdir/jetty-4.2.22/logs/console.log
}

function fixPermissionsOnSVNRepo() {
  sudo chown -R svn:svn /webdir/svn-repo
  sudo chmod 2770 -R /webdir/svn-repo
}

function mongrel_stop() {
  echo "stopping webserver in this rails tree ... "
  mongrel_rails stop
}

function nuke_www() {
  mongrel_stop
  rm -rf sites/www.tuvok.nl
  mysqladmin -u root -pW4nsmaak drop frontend_prod
  rake zena:init RAILS_ENV=production HOST=www.tuvok.nl
  mongrel_rails start -C /webdir/tuvok.nl/frontend/mongreld.conf
  pound_restart
}

function addQuestion() {
  if [[ $# == 0 || $# == 1 || $# == 2 ]]
  then
    echo "Usage: addQuestion title url name"
  else
      printf "<div>\n\t<p>$1</p>\n\t<a href=\"$2\">$i3</a><br />\n</div>\n\n" >> /webdir/tuvok.nl/dexter_noindex/scjp/questions.html
  fi
}

function start_dex () {
  if [[ -f /tmp/dexter.django.pid ]]
  then
    rm /tmp/dexter.django.pid
  fi
  /webdir/tuvok.nl/dexter/manage.py runfcgi method=threaded host=127.0.0.1 port=3033 pidfile=/tmp/dexter.django.pid
}

function stop_dex () {
  if [[ -f /tmp/dexter.django.pid ]]
  then
    kill `cat /tmp/dexter.django.pid`
    rm /tmp/dexter.django.pid
  else
    echo "No pidfile found, kill the process manually if it is running."
  fi
}

function restart_dex () {
  if [[ -f /tmp/dexter.django.pid ]]
  then
    stop_dex
    start_dex
  else
    start_dex
  fi
}

function tail_nginx_logs() {
  sudo tail -fn0 /var/log/nginx/*.log
}

function restart_ngnix() {
  sudo /etc/init.d/nginx restart
}

function create_snapshot() {
  SNAPSHOTDIR="snapshots"
  SNAPSHOTNAME="$1.`date '+%s'`.tbz"
  if [[ -d $SNAPSHOTDIR ]]
    then
      tar cjf $SNAPSHOTDIR/$SNAPSHOTNAME $1/
      echo "Created snapshot: $SNAPSHOTDIR/$SNAPSHOTNAME"
    else
      tar cjf $SNAPSHOTNAME $1/
      echo "Created snapshot: $SNAPSHOTNAME"
  fi

}

